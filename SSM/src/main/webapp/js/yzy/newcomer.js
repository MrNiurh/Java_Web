define(function(require){require("/static/moco/v1.0/dist/js/moco.min.js");var a=0,c=[],w=function(){isLogin?$.ajax({url:"//www.imooc.com/activity/newcomer",method:"get",dataType:"json",success:function(a){if(0==a.result&&a.data.is_new_user&&0==a.data.coupon[0].is_gain){$(".newcomer").removeClass("hide");for(var m=a.data.coupon,i=0;i<m.length;i++)c.push(m[i].marking);$(".newcomer").hasClass("index")&&"1"!=window.localStorage.getItem("neverSee")&&(require("/static/lib/jquery-mousewheel-3.1.13/jquery.mousewheel.js"),v())}else{if(0==a.result&&!a.data.is_new_user)return"1"==window.localStorage.getItem("hasClickIndex")&&$.alert("抱歉，新注册的用户才能参与此活动哦~"),$(".newcomer").addClass("hide"),window.localStorage.removeItem("hasClickIndex"),0;if(0==a.result&&a.data.is_new_user&&1==a.data.coupon[0].is_gain){if("1"==window.localStorage.getItem("hasClickIndex"))return $.alert("亲已经领过优惠券了哦，请在订单中心-我的优惠券中查看"),$(".newcomer").addClass("hide"),window.localStorage.removeItem("hasClickIndex"),0}else $(".newcomer").addClass("hide"),window.localStorage.removeItem("hasClickIndex")}},error:function(){moco.validateCallback.errorHint="网络错误"}}):(require("/static/lib/jquery-mousewheel-3.1.13/jquery.mousewheel.js"),$(".newcomer").removeClass("hide"),$(".newcomer").hasClass("index")&&"1"!=window.localStorage.getItem("neverSee")&&v()),$(document).on("click",".js-close",function(e){$(".newcomer").addClass("hide"),e.preventDefault()})},g={initModal:function(){var a='<div class="newcomer_mask"></div>    			<div class="newcomer_modal">        			<div class="get-btn js-get-btn">立即领取</div>        			<div class="js-moco-getcoupon" style="display:none"></div>        			<div class="next-time js-next-time">            			以后再说        			</div>    			</div>';$("#main").append(a)}},v=function(){var w=setInterval(function(){g.initModal(),clearInterval(w)},3e4);$(window).mousewheel(function(){return a+=1,10!=a?0:(g.initModal(),void clearInterval(w))}),"1"==window.localStorage.getItem("hasClickIndex")&&(g.initModal(),clearInterval(w),a=11,setTimeout(function(){$(".js-get-btn").trigger("click")},0));var v={bigTitle:"恭喜您",smalleTitle:"35元新人专享大礼包领取成功",api:"//www.imooc.com/activity/newcomer",apiData:{marking:c.join(",")},apiType:"POST",apiCrossType:"false",closeCallback:function(){window.localStorage.removeItem("hasClickIndex"),window.location.reload()},failCallback:function(a){window.localStorage.removeItem("hasClickIndex"),$(".newcomer_mask").hide(),$(".newcomer_modal").hide(),$.alert(a.msg,{callback:function(){window.location.reload()}})}};moco.getCoupon.init(v);var h=!1;$(document).on("click",".js-get-btn",function(){return isLogin?h?!1:(h=!0,$(this).text("正在领取..."),void $(".js-moco-getcoupon").trigger("click")):(window.localStorage.setItem("hasClickIndex",1),$("#js-signin-btn").trigger("click"),!1)}),$(document).on("click",".js-next-time",function(){$(".newcomer_mask").hide(),$(".newcomer_modal").hide(),a=11,window.localStorage.setItem("neverSee",1)})};w()});